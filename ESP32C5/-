cmake_minimum_required(VERSION 3.5)

# Dodaj flagÄ™ linkera globalnie
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,-zmuldefs")

include($ENV{IDF_PATH}/tools/cmake/project.cmake)
project(projectZero)


cmake_minimum_required(VERSION 3.16)          # zlikwiduje warning o starym CMake

# Standardowy bootstrap IDF
include($ENV{IDF_PATH}/tools/cmake/project.cmake)

# Nazwa aplikacji (pasuje do Twojego logu)
project(projectZero)

# ===== POST-BUILD: kopiowanie binarek do binaries-esp32c5 =====
# ĹšcieĹĽki
set(EXPORT_DIR "${CMAKE_SOURCE_DIR}/binaries-esp32c5")
file(MAKE_DIRECTORY "${EXPORT_DIR}")

# Skrypt robi: usuĹ„ stare *.bin (zostawia .py), skopiuj nowe
add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
  COMMAND ${CMAKE_COMMAND}
          -DDEST="${EXPORT_DIR}"
          -DBLD="${CMAKE_BINARY_DIR}"
          -DAPP="${PROJECT_NAME}.bin"
          -P "${CMAKE_SOURCE_DIR}/post_build.cmake"
)
